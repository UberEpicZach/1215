# THIS FILE EXISTS TO ENSURE CUSTOM GUI COMPATIBILITY!
# DO NOT EDIT THIS FILE DIRECTLY!
# IF YOU WISH TO INITIALIZE YOUR OWN GUI, DO IT BY:
# Creating an event widget
# Creating an event with that widget (See CustomGUI.1)
# Create a custom on_action file which appends to on_game_start_after_lobby and fires your event, as demonstrated below
# IF YOU WISH TO ADD A SIDEBAR BUTTON THAT OPENS THE CUSTOM GUI:
# Create a custom on_action which attaches to on_after_gui_dummy_male
# Fire the effect add_sidebar_button = {NAME = <string>}

##### GUI COMPATIBILITY ON_ACTIONS #####

# First we append to a vanilla on_action instead of editing the vanilla file, to ensure compatibility.
# Note that you can only append on_actions and events like this, NOT effects!
# Effects have to be invoked *in* the appended on_action!
# Empty scope
on_game_start_after_lobby = {
	on_actions = {
		on_custom_gui_initialize
	}
}
# This one is attached to continually check whether the GUI exists.
on_custom_gui_initialize = {
	on_actions = {
		delay = {days = 1}
		on_daily_custom_gui
	}
}	
# This is the appended on_action which lets us initialize the GUI via event widget.
# This can have an effect block since it wouldn't overwrite anything.
on_custom_gui_initialize = {
	effect = {
		every_player = {
			trigger_event = CustomGUI.1
		}
	}
	on_action = {
		on_monthly_custom_gui
	}
}
# For save game compatibility; Once per year we check if the GUI has been initialized. Otherwise, initialize!
on_yearly_global = {
	on_actions = {
		ensure_GUI_exists
	}
}
# This is a monthly on_action that modders can attach to. Empty scope.
on_monthly_custom_gui = {
	on_actions = {
		delay = { months = 1 }
		on_monthly_custom_gui
		ensure_GUI_exists
	}
}
# Every day: Check if the sidebar widget is open. 
on_daily_custom_gui = {
	#effect = {
	#}
	on_actions = {
		delay = { days = 1 }
		on_daily_custom_gui
		ensure_GUI_exists
	}
}
# ROOT IS DUMMY_MALE
# THIS MUST HAVE FIRED FOR ADD_SIDEBAR_BUTTON AND ADD_CUSTOM_GUI TO WORK
# APPEND TO THIS (IN A DIFFERENT FILE) TO ENSURE CUSTOM GUIS ARE EXECUTED ON GAME START
# (However, add_sidebar_button can be executed whenever you want)
on_after_gui_dummy_male = {
	effect = {
		add_custom_gui = {NAME = custom_sidebar}
		add_custom_gui = {NAME = custom_sidebar_bg}
	}
	on_actions = {
		ensure_GUI_exists
	#	your_on_action_goes_here_but_in_a_different_file
	}
}

# ROOT IS DUMMY_FEMALE
on_after_gui_dummy_female = {
	effect = {
	}
	on_actions = {
	#	your_on_action_goes_here_but_in_a_different_file
	}
}
# If the basic GUI failed to be created for some reason, here's a do-over.
ensure_GUI_exists = {
	trigger = {
		NOT = {is_widget_open = custom_sidebar}
		#NOT = {exists = global_var:dummy_male.var:custom_sidebar_loaded}
	}
	effect = {
		if = {
			limit = {
				exists = global_var:dummy_male
			}
			every_player = {
				trigger_event = CustomGUI.2
			}
		}
		else = {
			every_player = {
				trigger_event = CustomGUI.1
			}
		}
	}
}